(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{585:function(t,s,a){"use strict";a.r(s);var r=a(6),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",[t._v("最流行的开源数据库")])]),t._v(" "),a("h2",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),a("h3",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[t._v("#")]),t._v(" 日志")]),t._v(" "),a("p",[a("strong",[t._v("log-bin")]),t._v("：用于主从复制")]),t._v(" "),a("p",[a("strong",[t._v("log-error")]),t._v("：记录MySQL的错误日志，默认是"),a("strong",[t._v("关闭的")])]),t._v(" "),a("p",[a("strong",[t._v("log")]),t._v("：用于记录sql日志，默认是"),a("strong",[t._v("关闭的")])]),t._v(" "),a("h3",{attrs:{id:"数据文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据文件"}},[t._v("#")]),t._v(" 数据文件")]),t._v(" "),a("p",[a("strong",[t._v("frm文件")]),t._v("：存放表"),a("strong",[t._v("结构")])]),t._v(" "),a("p",[a("strong",[t._v("myd文件")]),t._v("：存放表"),a("strong",[t._v("数据")])]),t._v(" "),a("p",[a("strong",[t._v("myi文件")]),t._v("：存放表"),a("strong",[t._v("索引")])]),t._v(" "),a("h3",{attrs:{id:"架构层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构层"}},[t._v("#")]),t._v(" 架构层")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"架构图",href:"https://gitee.com/jtxyh/blogImg/raw/master/mysql架构图.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/mysql%E6%9E%B6%E6%9E%84%E5%9B%BE.png",alt:"架构图"}})])]),t._v(" "),a("h3",{attrs:{id:"连接层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接层"}},[t._v("#")]),t._v(" 连接层")]),t._v(" "),a("p",[a("strong",[t._v("最上层")]),t._v("的架构层，包括一些"),a("strong",[t._v("客户端和连接服务")]),t._v("，包含本地socket通信和大多数基于客户端/服务端工具实现的类型tcp/ip的通信。主要完成一些类似于"),a("strong",[a("em",[t._v("连接处理、授权认证"),a("em",[a("strong",[t._v("及相关的安全方案。在盖层引入了")]),t._v("线程池")])]),t._v("的概念，为通过认证安全接入的客户端提供线程。同样该层可以实现")]),t._v("基于SSL的安全连接**。服务器也会为安全接入的每个客户端验证它所具备的操作权限")]),t._v(" "),a("h3",{attrs:{id:"服务层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务层"}},[t._v("#")]),t._v(" 服务层")]),t._v(" "),a("p",[a("strong",[t._v("第二层")]),t._v("，主要完成大部分的"),a("strong",[t._v("核心功能")]),t._v("，如"),a("strong",[t._v("SQL接口")]),t._v("，并完成缓存的查询，SQL的分析和优化及部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如"),a("strong",[t._v("过程，函数")]),t._v("等。服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化，如"),a("strong",[t._v("确定查询表的顺序，是否利用索引")]),t._v("等，最后生成相应的执行操作。如果是select语句，服务器还会"),a("strong",[t._v("查询内部的缓存")]),t._v("。如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的系统的性能。")]),t._v(" "),a("h3",{attrs:{id:"引擎层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引擎层"}},[t._v("#")]),t._v(" 引擎层")]),t._v(" "),a("p",[a("strong",[t._v("第三层")]),t._v("，存储引擎真正的"),a("strong",[t._v("负责MySql中数据的存储和读取")]),t._v("，服务器通过API与存储引擎进行通信。不同的存储引擎具有的功能不同，包括"),a("strong",[t._v("MyISAM和InnoDB")]),t._v("等。")]),t._v(" "),a("h3",{attrs:{id:"存储层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储层"}},[t._v("#")]),t._v(" 存储层")]),t._v(" "),a("p",[a("strong",[t._v("第四层")]),t._v("，数据存储层，主要是"),a("strong",[t._v("将数据存储在运行于裸设备的文件系统之上")]),t._v("，并完成于存储引擎的交互")]),t._v(" "),a("h3",{attrs:{id:"myisam和innodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#myisam和innodb"}},[t._v("#")]),t._v(" MyISAM和InnoDB")]),t._v(" "),a("p",[a("strong",[t._v("show engines;")]),t._v("：查看数据库的"),a("strong",[t._v("使用的引擎")])]),t._v(" "),a("p",[a("strong",[t._v("show variables like '%storage_engine%';")]),t._v("：查看默认的"),a("strong",[t._v("存储引擎")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("对比")]),t._v(" "),a("th",[t._v("MyISAM")]),t._v(" "),a("th",[t._v("InnoDB")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("主外键")])]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td",[t._v("支持")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("事务")])]),t._v(" "),a("td",[t._v("不支持")]),t._v(" "),a("td",[t._v("支持")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("行表锁")])]),t._v(" "),a("td",[a("strong",[t._v("表锁")]),t._v("，即使一条记录也会锁住整个表不适合高并发的操作")]),t._v(" "),a("td",[a("strong",[t._v("行锁")]),t._v("，操作时只锁住一行，不对其他影响适合高并发")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("缓存")])]),t._v(" "),a("td",[t._v("只缓存索引，"),a("strong",[t._v("不缓存真实数据")])]),t._v(" "),a("td",[t._v("不仅缓存索引还"),a("strong",[t._v("缓存真实数据")]),t._v("对内存要求较高，而且内存大小对性能有影响")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("表空间")])]),t._v(" "),a("td",[t._v("小")]),t._v(" "),a("td",[t._v("大")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("关注点")])]),t._v(" "),a("td",[t._v("性能")]),t._v(" "),a("td",[t._v("事务")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("默认安装")])]),t._v(" "),a("td",[t._v("安装")]),t._v(" "),a("td",[t._v("安装")])])])]),t._v(" "),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("h3",{attrs:{id:"sql慢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql慢"}},[t._v("#")]),t._v(" sql慢")]),t._v(" "),a("p",[t._v("查询语句问题")]),t._v(" "),a("p",[t._v("索引失效")]),t._v(" "),a("p",[t._v("关联查询的join太多")]),t._v(" "),a("p",[t._v("服务器调优及各个参数的设置问题(缓冲，线程数)")]),t._v(" "),a("h3",{attrs:{id:"常见join查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见join查询"}},[t._v("#")]),t._v(" 常见join查询")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"join查询",href:"https://gitee.com/jtxyh/blogImg/raw/master/mysql%20join%E6%9F%A5%E8%AF%A2.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/mysql%20join%E6%9F%A5%E8%AF%A2.png",alt:"join查询"}})])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- inner join")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("inner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- left join")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- right join")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("right")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- left a join，只查询左侧")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- right a join，只查询左侧")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("right")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- full join，mysql不支持，所以使用这个")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("right")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- full join 排除共有")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp e "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("right")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" dep d "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("did "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"索引理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引理解"}},[t._v("#")]),t._v(" 索引理解")]),t._v(" "),a("p",[t._v("Mysql官方对索引的定义：索引(Index)是帮助Mysql高效获取数据的数据结构，"),a("strong",[t._v("索引是数据结构")])]),t._v(" "),a("p",[t._v("索引简单理解为："),a("strong",[t._v("排好序的快速查找的数据结构")])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"索引结构",href:"https://gitee.com/jtxyh/blogImg/raw/master/索引结构.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png",alt:"索引结构"}})])]),t._v(" "),a("p",[t._v("结论："),a("strong",[t._v("数据本身之外，数据库还维护着一个满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构的基础上实现高效查找算法，这种数据结构就是索引")])]),t._v(" "),a("p",[t._v("一般来说索引本身也很大，不可能全部存储在内存，因此索引往往以"),a("strong",[t._v("索引文件的形式存储在磁盘")])]),t._v(" "),a("p",[t._v("优势")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("提高数据检索的效率")]),t._v("，降低数据库的IO成本")]),t._v(" "),a("li",[t._v("通过索引列对数据进行排序，"),a("strong",[t._v("降低数据排序的成本")]),t._v("，降低CPU的消耗")])]),t._v(" "),a("p",[t._v("劣势")]),t._v(" "),a("ul",[a("li",[t._v("实际上索引也是一张表，表保存了主键和索引字段，并指向实体表的记录，所以"),a("strong",[t._v("索引列也是要占空间的")])]),t._v(" "),a("li",[t._v("索引大大"),a("strong",[t._v("提高了查询速度，但同时降低了update，insert，delete的速度")]),t._v("，因为在更新表时，mysql不仅仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段")])]),t._v(" "),a("h3",{attrs:{id:"mysql索引分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql索引分类"}},[t._v("#")]),t._v(" Mysql索引分类")]),t._v(" "),a("p",[a("strong",[t._v("单值索引")]),t._v("：一个索引只包含单个列，一个表可以有多个单列索引")]),t._v(" "),a("p",[a("strong",[t._v("唯一索引")]),t._v("：索引列的值"),a("strong",[t._v("必须唯一")]),t._v("，但允许有空值")]),t._v(" "),a("p",[a("strong",[t._v("复合索引")]),t._v("：一个索引包含多个列")]),t._v(" "),a("p",[a("strong",[t._v("创建")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- []中的可以省略，加上unique表示为 唯一索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unique")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" 索引名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" 表名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("字段"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" 表名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unique")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" 索引名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("字段"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("删除")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("drop")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" 索引名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" 表名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("查看")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" 表名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 添加一个主键，索引必须是唯一的，并且不能为NULL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" 表名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("primary")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("key")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("字段"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 添加一个唯一索引，可以为NULL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" 表名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unique")]),t._v(" 索引名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("字段"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 添加普通索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" 表名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" 索引名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("字段"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 添加全文索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" 表名 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" fulltext 索引名 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("字段"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"mysql索引结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql索引结构"}},[t._v("#")]),t._v(" Mysql索引结构")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"BTREE",href:"https://gitee.com/jtxyh/blogImg/raw/master/btree.jpg"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/btree.jpg",alt:"BTREE"}})])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"查询步骤",href:"https://gitee.com/jtxyh/blogImg/raw/master/查询步骤.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E6%9F%A5%E8%AF%A2%E6%AD%A5%E9%AA%A4.png",alt:"查询步骤"}})])]),t._v(" "),a("h3",{attrs:{id:"创建索引的条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建索引的条件"}},[t._v("#")]),t._v(" 创建索引的条件")]),t._v(" "),a("p",[a("strong",[t._v("需要创建索引")])]),t._v(" "),a("ol",[a("li",[t._v("主键自动创建唯一索引")]),t._v(" "),a("li",[t._v("频繁作为查询条件的字段")]),t._v(" "),a("li",[t._v("查询中与其他表关联的字段，外键关系建立索引")]),t._v(" "),a("li",[t._v("频繁更新的字段"),a("strong",[t._v("不适合")]),t._v("创建索引")]),t._v(" "),a("li",[t._v("where条件里用不到的字段"),a("strong",[t._v("不创建")])]),t._v(" "),a("li",[t._v("高并发情况下建议使用复合索引")]),t._v(" "),a("li",[t._v("查询中的排序字段，排序字段若通过索引访问将大大提高排序速度")]),t._v(" "),a("li",[t._v("查询中统计或者分组字段")])]),t._v(" "),a("p",[a("strong",[t._v("不需要创建索引")])]),t._v(" "),a("ol",[a("li",[t._v("表记录太少")]),t._v(" "),a("li",[t._v("经常增删改的表")]),t._v(" "),a("li",[t._v("数据重复分布平均的字段")])]),t._v(" "),a("h2",{attrs:{id:"explain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#explain"}},[t._v("#")]),t._v(" Explain")]),t._v(" "),a("h3",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[t._v("使用explain关键字可以模拟优化器执行SQL查询语句，从而知道Mysql是如何处理自己的SQL语句。"),a("strong",[t._v("分析出查询语句或者是表结构的性能瓶颈")])]),t._v(" "),a("p",[a("strong",[t._v("作用")]),t._v("：")]),t._v(" "),a("ol",[a("li",[t._v("得到表的"),a("strong",[t._v("读取顺序")])]),t._v(" "),a("li",[t._v("得到数据"),a("strong",[t._v("读取操作的操作类型")])]),t._v(" "),a("li",[t._v("得到"),a("strong",[t._v("哪些索引可以使用")])]),t._v(" "),a("li",[t._v("得到"),a("strong",[t._v("哪些索引被实际使用")])]),t._v(" "),a("li",[t._v("得到"),a("strong",[t._v("表之间的引用")])]),t._v(" "),a("li",[t._v("得到每张表有多少行"),a("strong",[t._v("被优化器查询")])])]),t._v(" "),a("h3",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("p",[a("strong",[t._v("explain + SQL语句")]),t._v(" "),a("strong",[t._v("包含的信息")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |\n")])])]),a("h3",{attrs:{id:"id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#id"}},[t._v("#")]),t._v(" id")]),t._v(" "),a("p",[t._v("select查询的序列号，包含一组数字，表示"),a("strong",[t._v("查询中执行select字句或操作表的顺序，值越大越先执行")])]),t._v(" "),a("p",[t._v("id"),a("strong",[t._v("相同")]),t._v("：执行顺序"),a("strong",[t._v("由上至下")]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"explain_id相同",href:"https://gitee.com/jtxyh/blogImg/raw/master/explain_id相同.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/explain_id%E7%9B%B8%E5%90%8C.png",alt:"explain_id相同"}})]),t._v("\nid"),a("strong",[t._v("不同")]),t._v("：如果是子查询，id的序号会递增，"),a("strong",[t._v("id值越大优先级越高，越先被执行")]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"explain_id不同",href:"https://gitee.com/jtxyh/blogImg/raw/master/explain_id不同.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/explain_id%E4%B8%8D%E5%90%8C.png",alt:"explain_id不同"}})]),t._v("\nid"),a("strong",[t._v("相同不同")]),t._v("：同时存在\n"),a("a",{attrs:{"data-fancybox":"",title:"explain_id相同又不同",href:"https://gitee.com/jtxyh/blogImg/raw/master/explain_id相同又不同.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/explain_id%E7%9B%B8%E5%90%8C%E5%8F%88%E4%B8%8D%E5%90%8C.png",alt:"explain_id相同又不同"}})])]),t._v(" "),a("h3",{attrs:{id:"select-type和table"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#select-type和table"}},[t._v("#")]),t._v(" select_type和table")]),t._v(" "),a("p",[t._v("select_type：代表"),a("strong",[t._v("查询的类型")]),t._v("，主要用来区别"),a("strong",[t._v("普通查询，联合查询，子查询等")]),t._v("复杂的查询")]),t._v(" "),a("p",[t._v("table：代表"),a("strong",[t._v("操作的是哪一张表")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("select_type")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("SIMPLE")])]),t._v(" "),a("td",[t._v("简单的select查询，查询中"),a("strong",[t._v("不包含子查询或union")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("PRIMARY")])]),t._v(" "),a("td",[t._v("查询中若包含任何复杂的子部分，最外层查询则被标记为primary")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("SUBQUERY")])]),t._v(" "),a("td",[t._v("在select或where列表"),a("strong",[t._v("包含了子查询")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("DERIUED")])]),t._v(" "),a("td",[t._v("在from列表中包含的子查询被标记为derived(衍生)"),a("br"),t._v("Mysql会递归执行这些子查询，"),a("strong",[t._v("把结果放在临时表里")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("UNION")])]),t._v(" "),a("td",[t._v("若"),a("strong",[t._v("第二个select出现在union之后")]),t._v("，则被标记为union"),a("br"),t._v("若union包含在from子句的子查询中，"),a("strong",[t._v("外层select将被标记为derived")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("UNION RESULT")])]),t._v(" "),a("td",[t._v("从union表获取结果的select")])])])]),t._v(" "),a("h3",{attrs:{id:"type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#type"}},[t._v("#")]),t._v(" type")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("type")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("ALL")])]),t._v(" "),a("td",[t._v("Full Table Scan，将"),a("strong",[t._v("遍历全表")]),t._v("以找到匹配的行")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("index")])]),t._v(" "),a("td",[t._v("Full Index Scan，index于ALL区别为"),a("strong",[t._v("index类型只遍历索引树")]),a("br")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("range")])]),t._v(" "),a("td",[a("strong",[t._v("只检索给定范围的行")]),t._v("，使用一个索引来选择行。key列显示用了哪个索引"),a("br"),t._v("一般就是在where语句中出现了between、>、<、in等的索引，这种"),a("strong",[t._v("范围扫描索引扫描比全表扫描好")]),a("br"),t._v("因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("ref")])]),t._v(" "),a("td",[a("strong",[t._v("非唯一性索引扫描，返回匹配某个单独值的所有行")]),a("br"),t._v("本质上也是一种索引访问，它返回所有匹配某个单独值的行"),a("br"),t._v("它可能会找到多个符合条件的行，所以它应该属于"),a("strong",[t._v("查找和扫描的混合体")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("eq_ref")])]),t._v(" "),a("td",[a("strong",[t._v("唯一性索引扫描")]),t._v("，对于每个索引键，"),a("strong",[t._v("表中只有一条记录与之匹配")]),t._v("，常见于主键或唯一索引扫描")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("const")])]),t._v(" "),a("td",[t._v("表示"),a("strong",[t._v("通过索引一次就找到了")]),t._v("，const用于比较primary key获取unique索引"),a("br"),t._v("因为只匹配一行数据，所以很快")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("system")])]),t._v(" "),a("td",[t._v("system"),a("strong",[t._v("表只有一行记录(等于系统表)")]),t._v("，这是const类型的特例，平时不会出现")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("NULL")])]),t._v(" "),a("td",[t._v("表示空")])])])]),t._v(" "),a("ul",[a("li",[t._v("显示查询"),a("strong",[t._v("使用了哪种类型")])]),t._v(" "),a("li",[t._v("从"),a("strong",[t._v("最好到最差")]),t._v("依次是")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("system > const > eq_ref > ref > range > index > ALL")])])]),t._v(" "),a("h3",{attrs:{id:"possible-keys和key和key-len"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#possible-keys和key和key-len"}},[t._v("#")]),t._v(" possible_keys和key和key_len")]),t._v(" "),a("p",[t._v("possible_keys："),a("strong",[t._v("显示可能应用这张表的索引")]),t._v("，一个或多个。查询涉及到的字段上若存在索引，则该索引被列出，"),a("strong",[t._v("但不一定被查询实际使用")])]),t._v(" "),a("p",[t._v("key：表示"),a("strong",[t._v("实际使用的索引")]),t._v("。如果为NULL，则表示没有索引。"),a("strong",[t._v("查询中若使用了覆盖索引，则该索引仅出现在key列表中")])]),t._v(" "),a("p",[t._v("key_len：表示"),a("strong",[t._v("索引中使用的字节数")]),t._v("，可以通过该列计算查询中使用的索引的长度。"),a("strong",[t._v("在不损失精确性的情况下，长度越短越好")]),t._v("。key_len显示的值为索引字段的最大可能长度，"),a("strong",[t._v("并非实际长度")]),t._v("，即key_len是根据表定义计算可得，不是通过表内检索出的")]),t._v(" "),a("h3",{attrs:{id:"ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[t._v("#")]),t._v(" ref")]),t._v(" "),a("p",[a("strong",[t._v("显示索引的哪一列被使用了，如果可能的话，是一个常数")]),t._v("。哪些列或常量被用于查找索引列上的值")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"ref引用",href:"https://gitee.com/jtxyh/blogImg/raw/master/ref引用.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/ref%E5%BC%95%E7%94%A8.png",alt:"ref引用"}})])]),t._v(" "),a("h3",{attrs:{id:"rows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rows"}},[t._v("#")]),t._v(" rows")]),t._v(" "),a("p",[t._v("根据表统计信息及索引选用情况，"),a("strong",[t._v("大致估算出找到所需的记录所需要读取的行数")])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"rows统计",href:"https://gitee.com/jtxyh/blogImg/raw/master/rows统计.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/rows%E7%BB%9F%E8%AE%A1.png",alt:"rows统计"}})])]),t._v(" "),a("h3",{attrs:{id:"extra"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extra"}},[t._v("#")]),t._v(" Extra")]),t._v(" "),a("p",[t._v("包含不适合在其他列中显示但十分重要的额外信息")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("解释")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("Using filesort")])]),t._v(" "),a("td",[t._v("说明Mysql会"),a("strong",[t._v("对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取")]),a("br"),t._v("Mysql中无法利用索引完成的排序操作称为"),a("strong",[t._v("文件排序")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Using temporary")])]),t._v(" "),a("td",[a("strong",[t._v("使用了临时表保存中间结果")]),t._v("，Mysql在对查询结果排序时使用临时表。"),a("br"),t._v("常见于order by和分组查询group by")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Using index")])]),t._v(" "),a("td",[t._v("表示相应的select操作中使用了"),a("strong",[t._v("覆盖索引")]),t._v("(下面有解释)，避免访问了表的数据行，效率不错"),a("br"),t._v("如果出现了"),a("strong",[t._v("using where")]),t._v("，表明索引被用来执行索引值的"),a("strong",[t._v("查找")]),a("br"),t._v("没有出现表明索引用来"),a("strong",[t._v("读取数据")]),t._v("而非执行查找动作")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("Using where")])]),t._v(" "),a("td",[t._v("表示使用了"),a("strong",[t._v("where过滤")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("using join buffer")])]),t._v(" "),a("td",[t._v("表示使用了"),a("strong",[t._v("连接缓存")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("impossible where")])]),t._v(" "),a("td",[a("strong",[t._v("where子句中的值总是false")]),t._v("，不能用来获取任何元组")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("select tables optimized away")])]),t._v(" "),a("td",[t._v("在没有group by子句的情况下，"),a("strong",[t._v("基于索引优化min/max操作或者MyISAM存储引擎优化count(*)操作")]),a("br"),t._v("不必等到执行阶段再进行计算，"),a("strong",[t._v("查询执行计划阶段生成的阶段")]),t._v("即完成优化")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("distinct")])]),t._v(" "),a("td",[t._v("优化distinct操作，"),a("strong",[t._v("在查找到第一匹配的元组后即停止找同样值的动作")])])])])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"Usingfilesort",href:"https://gitee.com/jtxyh/blogImg/raw/master/Usingfilesort.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/Usingfilesort.png",alt:"Usingfilesort"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"Usingtemporary",href:"https://gitee.com/jtxyh/blogImg/raw/master/Usingtemporary.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/Usingtemporary.png",alt:"Usingtemporary"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"Usingindex",href:"https://gitee.com/jtxyh/blogImg/raw/master/Usingindex.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/Usingindex.png",alt:"Usingindex"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"覆盖索引",href:"https://gitee.com/jtxyh/blogImg/raw/master/覆盖索引.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95.png",alt:"覆盖索引"}})])]),t._v(" "),a("h2",{attrs:{id:"索引优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引优化"}},[t._v("#")]),t._v(" 索引优化")]),t._v(" "),a("h3",{attrs:{id:"join优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#join优化"}},[t._v("#")]),t._v(" join优化")]),t._v(" "),a("p",[a("strong",[t._v("左连接时建立右表索引，右连接建立左表索引")])]),t._v(" "),a("p",[t._v("尽可能减少join语句中嵌套循环(NestedLoop)的循环总次数："),a("strong",[t._v("永远用小的结果集驱动大的结果集")])]),t._v(" "),a("p",[t._v("优先优化嵌套循环(NestedLoop)的"),a("strong",[t._v("内层循环")])]),t._v(" "),a("p",[a("strong",[t._v("保证join语句中被驱动表上join条件字段已经被索引")])]),t._v(" "),a("p",[t._v("当无法保证被驱动表的"),a("strong",[t._v("join条件字段被索引且内存资源充足的前提下")]),t._v("，不要太吝啬JoinBuffer的设置")]),t._v(" "),a("h3",{attrs:{id:"like优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#like优化"}},[t._v("#")]),t._v(" like优化")]),t._v(" "),a("p",[t._v("like**使用右%**比左%和左右%性能更好")]),t._v(" "),a("p",[t._v("使用"),a("strong",[t._v("覆盖索引")]),t._v("来优化左右%的使用")]),t._v(" "),a("h3",{attrs:{id:"索引失效原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引失效原因"}},[t._v("#")]),t._v(" 索引失效原因")]),t._v(" "),a("p",[a("strong",[t._v("全值匹配时")]),t._v("会导致索引失效")]),t._v(" "),a("p",[t._v("最佳左前缀法则，"),a("strong",[t._v("使用索引时使用创建索引顺序的最左侧开始使用")]),t._v("，否则导致索引失效")]),t._v(" "),a("p",[a("strong",[t._v("不在索引列上做任何操作(计算、函数、自动或手动类型转换)")]),t._v("，导致索引失效")]),t._v(" "),a("p",[t._v("存储引擎不能使用索引中范围条件右侧的列")]),t._v(" "),a("p",[t._v("尽量"),a("strong",[t._v("使用覆盖索引(只访问索引的查询)")]),t._v("，减少使用select *")]),t._v(" "),a("p",[t._v("mysql在**使用!=或者<>**时会导致索引失效")]),t._v(" "),a("p",[t._v("使用"),a("strong",[t._v("is null，is not null")]),t._v("会导致索引失效")]),t._v(" "),a("p",[a("strong",[t._v("like以通配符开头")]),t._v("会导致索引失效")]),t._v(" "),a("p",[a("strong",[t._v("字符串不用单引号")]),t._v("会导致索引失效")]),t._v(" "),a("p",[a("strong",[t._v("少用or")]),t._v("，or会导致索引失效")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"索引案例",href:"https://gitee.com/jtxyh/blogImg/raw/master/索引案例.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E7%B4%A2%E5%BC%95%E6%A1%88%E4%BE%8B.png",alt:"索引案例"}})])]),t._v(" "),a("h3",{attrs:{id:"sql分析步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql分析步骤"}},[t._v("#")]),t._v(" SQL分析步骤")]),t._v(" "),a("p",[t._v("观察在生产环境运行一天的结果")]),t._v(" "),a("p",[t._v("开启"),a("strong",[t._v("慢查询分析")])]),t._v(" "),a("p",[t._v("用"),a("strong",[t._v("explain+慢SQL分析")])]),t._v(" "),a("p",[t._v("使用"),a("strong",[t._v("show profile")]),t._v("查询SQL在Mysql服务器中的执行细节和生命周期情况")]),t._v(" "),a("p",[t._v("SQL数据库服务器的"),a("strong",[t._v("参数调优")])]),t._v(" "),a("h3",{attrs:{id:"in和exists"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#in和exists"}},[t._v("#")]),t._v(" in和exists")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"in和exists",href:"https://gitee.com/jtxyh/blogImg/raw/master/in和exists.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/in%E5%92%8Cexists.png",alt:"in和exists"}})])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exists")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("将主查询的数据，放到子查询中做条件验证，根据验证结果(true或false)来决定主查询的数据结果是否得以保留")])]),t._v(" "),a("p",[a("strong",[t._v("exists(sub)只返回true或false")]),t._v("，因此在子查询中的select * 也可以是 select 1，官方说法是实际执行时"),a("strong",[t._v("会忽略select清单")]),t._v("，所以没有区别")]),t._v(" "),a("p",[t._v("exists子查询的实际执行过程可能经过了优化而"),a("strong",[t._v("不是我们理解的逐条优化")])]),t._v(" "),a("p",[t._v("exists子查询往往也可以用条件表达式，其他"),a("strong",[t._v("子查询获取join来替代")])]),t._v(" "),a("h3",{attrs:{id:"order-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#order-by"}},[t._v("#")]),t._v(" order by")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"orderby出现filesort",href:"https://gitee.com/jtxyh/blogImg/raw/master/orderby出现filesort.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/orderby%E5%87%BA%E7%8E%B0filesort.png",alt:"orderby出现filesort"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"orderby出现filesort",href:"https://gitee.com/jtxyh/blogImg/raw/master/orderby出现filesort2.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/orderby%E5%87%BA%E7%8E%B0filesort2.png",alt:"orderby出现filesort"}})])]),t._v(" "),a("p",[t._v("Mysql支持两种方式的排序，"),a("strong",[t._v("FileSort和Index，Index效率高，FileSort效率较低")]),t._v("，Index指Mysql"),a("strong",[t._v("扫描索引")]),t._v("本身完成排序")]),t._v(" "),a("p",[t._v("order by满足两种情况时"),a("strong",[t._v("会使用Index排序")])]),t._v(" "),a("ol",[a("li",[t._v("order by语句使用"),a("strong",[t._v("索引最左前列")])]),t._v(" "),a("li",[t._v("使用where字句于order by子句条件列满足"),a("strong",[t._v("索引最左前列")])])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"order by总结",href:"https://gitee.com/jtxyh/blogImg/raw/master/orderby总结.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/orderby%E6%80%BB%E7%BB%93.png",alt:"order by总结"}})])]),t._v(" "),a("h3",{attrs:{id:"group-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#group-by"}},[t._v("#")]),t._v(" group by")]),t._v(" "),a("p",[t._v("同"),a("strong",[t._v("order by 类型")])]),t._v(" "),a("p",[t._v("group by 实质是"),a("strong",[t._v("先排序后进行分组")]),t._v("，遵循索引建的"),a("strong",[t._v("最佳左前缀原则")])]),t._v(" "),a("p",[t._v("当无法使用索引列时，增大"),a("strong",[t._v("max_length_for_sort_data")]),t._v("参数设置和增大"),a("strong",[t._v("sort_buffer_size")]),t._v("参数设置")]),t._v(" "),a("p",[t._v("where高于having，能"),a("strong",[t._v("写在where限定的条件就不要去having限定了")])]),t._v(" "),a("h3",{attrs:{id:"慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志"}},[t._v("#")]),t._v(" 慢查询日志")]),t._v(" "),a("p",[t._v("Mysql的慢查询日志是Mysql提供的一种日志记录，它用来记录"),a("strong",[t._v("在Mysql中响应时间超过阈值的语句")]),t._v("，具体指运行时间超过"),a("strong",[t._v("long_query_time")]),t._v("的值的SQL")]),t._v(" "),a("p",[a("strong",[t._v("long_query_time")]),t._v("的默认值是"),a("strong",[t._v("10秒")])]),t._v(" "),a("p",[t._v("默认情况下，"),a("strong",[t._v("Mysql数据库没有开启慢查询日志")]),t._v("，需要手动打开。慢查询日志会对性能有一定的影响，所以不是调优的时候建议关闭")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查看是否开启")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%slow_query_log%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 开启，只对当前数据库生效，重启失效")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" slow_query_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查看默认的秒数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'long_query_time%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 用于修改后查看，不用重新连接")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'long_query_time'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 自定义设置时间为3秒")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 修改后需要重新连接或新开一个会话才能看到修改的值")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 或者使用带global的查看")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" long_query_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查看有几条慢的SQL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%slow_queries%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("mysqldumpslow")]),t._v("工具是Mysql官方提供的慢查询日志分析工具")]),t._v(" "),a("p",[t._v("在终端输入："),a("strong",[t._v("mysqldumpslow --help")])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"mysql分析工具",href:"https://gitee.com/jtxyh/blogImg/raw/master/mysql分析工具1.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/mysql%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B71.png",alt:"mysql分析工具"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"mysql分析工具",href:"https://gitee.com/jtxyh/blogImg/raw/master/mysql分析工具2.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/mysql%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B72.png",alt:"mysql分析工具"}})])]),t._v(" "),a("h3",{attrs:{id:"show-profile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-profile"}},[t._v("#")]),t._v(" show profile")]),t._v(" "),a("p",[t._v("是Mysql提供可以用来分析当前会话中语句执行的资源消耗情况，用于SQL调优")]),t._v(" "),a("p",[t._v("默认是关闭的，并保存15次查询的结果")]),t._v(" "),a("p",[t._v("分析步骤")]),t._v(" "),a("ol",[a("li",[t._v("查看是否支持："),a("strong",[t._v("show variables like 'profiling';")])]),t._v(" "),a("li",[t._v("开启功能："),a("strong",[t._v("set profiling = on;")])]),t._v(" "),a("li",[t._v("运行SQL")]),t._v(" "),a("li",[t._v("查看结果："),a("strong",[t._v("show profiles;")])]),t._v(" "),a("li",[t._v("诊断SQL："),a("strong",[t._v("show profile cpu,block io for query 上一步查看后的SQL数字号码;")])])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"show profile后面的参数",href:"https://gitee.com/jtxyh/blogImg/raw/master/profile查看的参数.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/profile%E6%9F%A5%E7%9C%8B%E7%9A%84%E5%8F%82%E6%95%B0.png",alt:"show profile后面的参数"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"profile查询结果",href:"https://gitee.com/jtxyh/blogImg/raw/master/profile查询结果.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/profile%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C.png",alt:"profile查询结果"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"profile故障结果",href:"https://gitee.com/jtxyh/blogImg/raw/master/profile故障结果.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/profile%E6%95%85%E9%9A%9C%E7%BB%93%E6%9E%9C.png",alt:"profile故障结果"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"profile结论",href:"https://gitee.com/jtxyh/blogImg/raw/master/profile结论.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/profile%E7%BB%93%E8%AE%BA.png",alt:"profile结论"}})])]),t._v(" "),a("h3",{attrs:{id:"全局日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局日志"}},[t._v("#")]),t._v(" 全局日志")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"编码启用全局日志",href:"https://gitee.com/jtxyh/blogImg/raw/master/编码启用全局日志.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E7%BC%96%E7%A0%81%E5%90%AF%E7%94%A8%E5%85%A8%E5%B1%80%E6%97%A5%E5%BF%97.png",alt:"编码启用全局日志"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"配置启用全局日志",href:"https://gitee.com/jtxyh/blogImg/raw/master/配置启用全局日志.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E9%85%8D%E7%BD%AE%E5%90%AF%E7%94%A8%E5%85%A8%E5%B1%80%E6%97%A5%E5%BF%97.png",alt:"配置启用全局日志"}})])]),t._v(" "),a("h2",{attrs:{id:"mysql锁机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql锁机制"}},[t._v("#")]),t._v(" Mysql锁机制")]),t._v(" "),a("h3",{attrs:{id:"分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[t._v("#")]),t._v(" 分类")]),t._v(" "),a("p",[a("strong",[t._v("数据操作的类型")]),t._v("分类")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("读锁(共享锁)")]),t._v("：针对同一份数据，多个读操作可以同时进行而不会互相影响")]),t._v(" "),a("li",[a("strong",[t._v("写锁(排它锁)")]),t._v("：当前写操作没有完成前，它会阻断其他写锁和读锁")])]),t._v(" "),a("p",[a("strong",[t._v("操作粒度")]),t._v("分类")]),t._v(" "),a("ul",[a("li",[t._v("表锁")]),t._v(" "),a("li",[t._v("行锁")])]),t._v(" "),a("h3",{attrs:{id:"表锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表锁"}},[t._v("#")]),t._v(" 表锁")]),t._v(" "),a("p",[t._v("偏向MyISAM存储引擎，"),a("strong",[t._v("开销小，加锁快，无死锁")]),t._v("，锁定粒度大，发生锁冲突的概率"),a("strong",[t._v("最高")]),t._v("，并发度"),a("strong",[t._v("低")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 手动增加表锁")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- read 代表读锁，write代表写锁")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lock")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" 表名字 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("read")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 表名字"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("read")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查看加过锁的表")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 释放表锁")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unlock")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("MyISAM表添加"),a("strong",[t._v("读锁")]),t._v("后")]),t._v(" "),a("ul",[a("li",[t._v("当前终端"),a("strong",[t._v("可以读锁定的表")]),t._v("，但不能修改和增加数据到当前的表，"),a("strong",[t._v("不能读取其他的表")])]),t._v(" "),a("li",[t._v("其他终端"),a("strong",[t._v("可以读取锁定的表和其他的表")]),t._v("，但修改和增加数据到锁定的表会"),a("strong",[t._v("一直处于阻塞状态")])])]),t._v(" "),a("p",[t._v("MyISAM表添加"),a("strong",[t._v("写锁")]),t._v("后")]),t._v(" "),a("ul",[a("li",[t._v("当前终端"),a("strong",[t._v("可以读和修改锁定的表")]),t._v("，"),a("strong",[t._v("不能读取其他的表")])]),t._v(" "),a("li",[t._v("其他终端"),a("strong",[t._v("阻塞读取锁定的表")])])]),t._v(" "),a("p",[t._v("总结："),a("strong",[t._v("读锁会阻塞写，但不会阻塞读。而写锁则会把读和写都阻塞")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 分析表锁定")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("show")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'table%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("Table_locks_immediate")]),t._v("："),a("strong",[t._v("产生表级锁定的次数")]),t._v("，表示可以立即获取锁的查询次数，每立即获取锁值加1")]),t._v(" "),a("p",[a("strong",[t._v("Table_locks_waited")]),t._v("："),a("strong",[t._v("出现表级锁定争用而发生等待的次数")]),t._v("(不能立即获取锁的次数，每次等待一次锁值加1)，此值高则说明存在着较严重的表级锁争用情况")]),t._v(" "),a("p",[t._v("MyISAM的读写锁调度是"),a("strong",[t._v("写优先")]),t._v("，所以MyISAM"),a("strong",[t._v("不适合做写为主表的引擎")]),t._v("，因为写锁后，其他线程不能做任何操作，大量的更新会使查询难得到锁，从而造成永久阻塞")]),t._v(" "),a("h3",{attrs:{id:"行锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#行锁"}},[t._v("#")]),t._v(" 行锁")]),t._v(" "),a("p",[t._v("偏向InnoDB存储引擎，"),a("strong",[t._v("开销大，加锁慢，会出现死锁")]),t._v("；锁定粒度最小，发生锁冲突的概率最低，并发度也最高")]),t._v(" "),a("p",[t._v("InnoDB与MyISAM的的不同点："),a("strong",[t._v("一是支持事务，而是采用了行锁")])]),t._v(" "),a("p",[t._v("行锁更新了数据没有提交，"),a("strong",[t._v("其他终端操作同一条数据会处于阻塞状态")]),t._v("，但操作其他数据不会有影响")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 设置行锁，关闭自动提交")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" autocommit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 提交")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("索引失效后行锁会升级为表锁")]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"索引失效变表锁",href:"https://gitee.com/jtxyh/blogImg/raw/master/索引失效变表锁.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%8F%98%E8%A1%A8%E9%94%81.png",alt:"索引失效变表锁"}})])]),t._v(" "),a("p",[a("strong",[t._v("间隙锁")]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"间隙锁介绍",href:"https://gitee.com/jtxyh/blogImg/raw/master/间隙锁介绍.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E9%97%B4%E9%9A%99%E9%94%81%E4%BB%8B%E7%BB%8D.png",alt:"间隙锁介绍"}})]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"间隙锁案例",href:"https://gitee.com/jtxyh/blogImg/raw/master/间隙锁案例.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E9%97%B4%E9%9A%99%E9%94%81%E6%A1%88%E4%BE%8B.png",alt:"间隙锁案例"}})])]),t._v(" "),a("p",[a("strong",[t._v("单行锁定")]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"锁定一行",href:"https://gitee.com/jtxyh/blogImg/raw/master/锁定一行.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E9%94%81%E5%AE%9A%E4%B8%80%E8%A1%8C.png",alt:"锁定一行"}})])]),t._v(" "),a("p",[a("strong",[t._v("查看锁状态")]),t._v(" "),a("a",{attrs:{"data-fancybox":"",title:"查看锁状态",href:"https://gitee.com/jtxyh/blogImg/raw/master/查看锁状态.png"}},[a("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/%E6%9F%A5%E7%9C%8B%E9%94%81%E7%8A%B6%E6%80%81.png",alt:"查看锁状态"}})])])])}),[],!1,null,null,null);s.default=e.exports}}]);