(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{620:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",[s._v("Docker Compose和Docker swarm让Docker更简化更智能")])]),s._v(" "),t("h2",{attrs:{id:"docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker Compose")]),s._v(" "),t("p",[t("strong",[s._v("Compose是服务编排重要的组成部分，是Docker官方的开源项目")])]),s._v(" "),t("p",[s._v("通过Docker-Compose编写yaml配置文件，可以通过compose"),t("strong",[s._v("一键启动停止多个服务")])]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://get.daocloud.io/docker/compose/releases/download/1.26.2/docker-compose-'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -o /usr/local/bin/docker-compose\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\n")])])]),t("h3",{attrs:{id:"yaml规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml规则"}},[s._v("#")]),s._v(" yaml规则")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分3层")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("images")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("服务2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("images")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他配置 网络/卷 全局规则")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])])]),t("h3",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器后台运行")]),s._v("\ndocker-compose up -d\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止容器")]),s._v("\ndocker-compose down\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新部署打包，重新构建")]),s._v("\ndocker-compose up --build\n")])])]),t("h2",{attrs:{id:"docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm"}},[s._v("#")]),s._v(" Docker Swarm")]),s._v(" "),t("h3",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化一个swarm")]),s._v("\ndocker swarm init --advertise-addr ip地址\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取令牌")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取管理令牌")]),s._v("\ndocker swarm join-token manager\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取工作令牌")]),s._v("\ndocker swarm join-token worker\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看节点信息，只有管理能够查看")]),s._v("\ndocker node "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建项目，默认一个副本")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 --name my-nginx nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建5个副本")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" scale my-nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])]),t("h3",{attrs:{id:"概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),t("p",[t("strong",[s._v("Raft协议")]),s._v("：保证大多数节点存活才可以用，集群"),t("strong",[s._v("至少大于3台服务")])]),s._v(" "),t("p",[t("strong",[s._v("swarm")]),s._v("："),t("strong",[s._v("集群的管理和编排")]),s._v("，docker可以初始化一个swarm集群，其他节点可以加入(管理、工作者)")]),s._v(" "),t("p",[t("strong",[s._v("Node")]),s._v("：就是一个docker节点，多个节点就组成了一个网络集群(管理、工作者)")]),s._v(" "),t("p",[t("strong",[s._v("Service")]),s._v("：任务，可以在管理节点或者工作节点来运行")]),s._v(" "),t("p",[t("strong",[s._v("Task")]),s._v("：容器内的命令")])])}),[],!1,null,null,null);a.default=n.exports}}]);