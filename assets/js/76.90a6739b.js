(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{574:function(t,a,s){"use strict";s.r(a);var e=s(6),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",[t._v("Spring安全管理框架")])]),t._v(" "),s("h2",{attrs:{id:"引入依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引入依赖"}},[t._v("#")]),t._v(" 引入依赖")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-security"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h2",{attrs:{id:"基本原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本原理"}},[t._v("#")]),t._v(" 基本原理")]),t._v(" "),s("p",[t._v("SpringSecurity本质是一个"),s("strong",[t._v("过滤器链")])]),t._v(" "),s("p",[s("code",[t._v("FilerSecurityInterceptor")]),t._v(":是一个方法级的权限过滤器,基本位于过滤器的最底部")]),t._v(" "),s("p",[s("code",[t._v("ExceptionTranslationFilter")]),t._v(":异常过滤器,用来处理在认证授权过程 中抛出的异常")]),t._v(" "),s("p",[s("code",[t._v("UsernamePasswordAuthenticationFilter")]),t._v(":对/login的POST请求做拦截,校验表单中的用户名和密码")]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"过滤器是如何加载的",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118110836.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118110836.png",alt:"过滤器是如何加载的"}})])]),t._v(" "),s("h2",{attrs:{id:"基础接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础接口"}},[t._v("#")]),t._v(" 基础接口")]),t._v(" "),s("h3",{attrs:{id:"userdetailservice"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#userdetailservice"}},[t._v("#")]),t._v(" UserDetailService")]),t._v(" "),s("p",[s("strong",[t._v("查询数据库用户名和密码的接口")])]),t._v(" "),s("p",[t._v("创建类继承"),s("code",[t._v("UsernamePasswordAuthenticationFilter")]),t._v(",重写三个方法")]),t._v(" "),s("p",[t._v("创建类实现"),s("code",[t._v("UserDetailService")]),t._v(",编写查询数据过程,发回User对象,这个User对象是安全框架提供对象")]),t._v(" "),s("h3",{attrs:{id:"passwordencoder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passwordencoder"}},[t._v("#")]),t._v(" PasswordEncoder")]),t._v(" "),s("p",[s("strong",[t._v("数据加密接口,用于返回User对象里面的密码加密")])]),t._v(" "),s("h2",{attrs:{id:"设置用户名和密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置用户名和密码"}},[t._v("#")]),t._v(" 设置用户名和密码")]),t._v(" "),s("h3",{attrs:{id:"通过配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过配置文件"}},[t._v("#")]),t._v(" 通过配置文件")]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"配置文件设置",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118115214.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118115214.png",alt:"配置文件设置"}})])]),t._v(" "),s("h3",{attrs:{id:"通过配置类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过配置类"}},[t._v("#")]),t._v(" 通过配置类")]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"配置类设置",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118115241.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118115241.png",alt:"配置类设置"}})])]),t._v(" "),s("h3",{attrs:{id:"自定义编写实现类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义编写实现类"}},[t._v("#")]),t._v(" 自定义编写实现类")]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"自定义编写设置",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118134034.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118134034.png",alt:"自定义编写设置"}})])]),t._v(" "),s("h2",{attrs:{id:"权限控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限控制"}},[t._v("#")]),t._v(" 权限控制")]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"权限控制1",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118144423.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118144423.png",alt:"权限控制1"}})])]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"权限控制2",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118145242.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118145242.png",alt:"权限控制2"}})])]),t._v(" "),s("p",[s("a",{attrs:{"data-fancybox":"",title:"权限控制3",href:"https://gitee.com/jtxyh/blogImg/raw/master/20201118145150.png"}},[s("img",{attrs:{src:"https://gitee.com/jtxyh/blogImg/raw/master/20201118145150.png",alt:"权限控制3"}})])]),t._v(" "),s("h2",{attrs:{id:"注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注解"}},[t._v("#")]),t._v(" 注解")]),t._v(" "),s("h3",{attrs:{id:"secured"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secured"}},[t._v("#")]),t._v(" @Secured")]),t._v(" "),s("p",[t._v("判断是否具有角色,"),s("strong",[t._v("字符串需要添加前缀"),s("code",[t._v("ROLE_")])])]),t._v(" "),s("p",[t._v("使用之前需要在启动类上开启注解"),s("code",[t._v("@EnableGlobalMethodSecurity(securedEnabled=true)")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 有admin角色和root角色可以访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Secured")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ROLE_admin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ROLE_root"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResponseResult")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("genCodeQr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// xxxxxx")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResponseResult")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"preauthorize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preauthorize"}},[t._v("#")]),t._v(" @PreAuthorize")]),t._v(" "),s("p",[t._v("开启注解"),s("code",[t._v("@EnableGlobalMethodSecurity(prePostEnabled=true)")])]),t._v(" "),s("p",[t._v("该注解适合"),s("strong",[t._v("进入方法前的权限验证")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 有有admins权限的可以访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PreAuthorize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"hasAnyAuthority('admins')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResponseResult")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("genCodeQr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// xxxxxx")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResponseResult")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);